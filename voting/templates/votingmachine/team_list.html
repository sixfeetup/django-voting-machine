{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="row">
    <div class="col-md-12">
            <h2>Teams</h2>
            {% if user and not user.is_anonymous %}
              <a href="{% url 'users:create_team'%}" class="btn btn-success pull-right">Create Team</a>
          {% else %}
            You need to login to see Event information!
          {% endif %}
    </div>
    </div>
        {% for team in object_list %}
            <h3>{{ team.title }}</h3>
                <li>{{ team }}
                    {% if request.user in team.members.all %}
                        <button class="btn btn-primary" type="submit"
                                data-action="leave" data-team="{{ team.id }}">LEAVE</button>
                    {% else %}
                        <button class="btn btn-success" type="submit"
                                data-action="join" data-team="{{ team.id }}">JOIN</button>
                    {% endif %}
                </li>
            <p>{{team.description}}</p>
            <li>Team Leader: {{team.leader  }}</li>
            <ol>
                {% for member in team.members.all %}
                    <li>{{member}}</li>
                {% endfor %}
            </ol>
            <hr>
        {% empty %}
            <p>No Teams yet.</p>
        {% endfor %}


<script>
(function($) { $(function() {
    $('button').click(function(){
        $btn = $(this);
        var team_id = $(this).attr("data-team");
        var taction = $(this).attr("data-action");
         $.post('/votingmachine/event/team/' + team_id + '/' + taction + "/",
                {csrfmiddlewaretoken: '{{ csrf_token }}'},
                function(data){
                    if (data.status == 'OK') {
                        window.location.reload();
                    } else {
                        $btn.after('<span class="err-msg">' + data.message + ' ' + data.reason + '</span>');
                    }
                });
     });
}); })(jQuery);
</script>

{% endblock %}

{##}
{#{% if object == request.user %}#}
{#   {%  for event in view.all_events.all %}#}
{#      <h3>{{ event }}</h3>#}
{#            <ol>#}
{#            {% for team in event.team_set.all %}#}
{#                <li>{{ team }}#}
{#                    {% if request.user in team.members.all %}#}
{#                        <button class="btn btn-primary" type="submit"#}
{#                                data-action="leave" data-team="{{ team.id }}">LEAVE</button>#}
{#                    {% else %}#}
{#                        <button class="btn btn-success" type="submit"#}
{#                                data-action="join" data-team="{{ team.id }}">JOIN</button>#}
{#                    {% endif %}#}
{#                </li>#}
{#            {%  endfor %}#}
{#            </ol>#}
{#      <hr>#}
{#   {%  endfor %}#}
{##}
{#{% endif %}#}
