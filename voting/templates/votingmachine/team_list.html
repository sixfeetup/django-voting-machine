{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="row">
    <div class="col-md-12">
            <h2>Teams</h2>
        {% if team_list.event_id.status == 'open' %}
            <p> There are no teams created for this event yet.</p>
            {% if user and not user.is_anonymous %}
                <a href="{% url 'users:create_team'%}" class="btn btn-success pull-right">Create Team</a>
            {% else %}
                You need to login to see Event information!
            {% endif %}
        {% else %}
            {% if user and not user.is_anonymous %}
              <a href="{% url 'users:create_team'%}" class="btn btn-success pull-right">Create Team</a>
            {% else %}
                You need to login to see Event information!
            {% endif %}
        {% endif %}

    </div>
    </div>

        {% for team in team_list %}
            {% if team.event.status == 'open'%}
                <h3>{{ team.title|upper  }}</h3>
                <li> {{ team.title}} : {{ team.description }}
                    {% if request.user in team.members.all %}
                        <button class="btn btn-primary" type="submit"
                                data-action="leave" data-team="{{ team.id }}">LEAVE</button>
                    {% else %}
                        <button class="btn btn-success" type="submit"
                                data-action="join" data-team="{{ team.id }}">JOIN</button>
                    {% endif %}
                </li>
                <li> Event: {{ team.event.title }}</li>
                <li> Team Leader: {{team.leader }}</li>
                <li> Members:
                <ol>{% for member in team.all_members %}
                        <li>{{member}}</li>
                    {% endfor %}</ol></li>
            {% endif %}
        {% empty %}
            <li> There are no teams created for this event yet.</li>
        {% endfor %}
    <hr>


<script>
(function($) { $(function() {
    $('button').click(function(){
        $btn = $(this);
        var team_id = $(this).attr("data-team");
        var taction = $(this).attr("data-action");
         $.post('/votingmachine/event/team/' + team_id + '/' + taction + "/",
                {csrfmiddlewaretoken: '{{ csrf_token }}'},
                function(data){
                    if (data.status == 'OK') {
                        window.location.reload();
                    } else {
                        $btn.after('<span class="err-msg">' + data.message + ' ' + data.reason + '</span>');
                    }
                });
     });
}); })(jQuery);
</script>

{% endblock %}


